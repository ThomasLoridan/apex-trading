<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Apex Trading Intelligence ¬∑ Ultimate Edition</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');
*{margin:0;padding:0;box-sizing:border-box}
:root{--black:#000;--white:#FFF;--gray-50:#FAFAFA;--gray-100:#F5F5F5;--gray-200:#E5E5E5;--gray-300:#D4D4D4;--gray-400:#A3A3A3;--gray-500:#737373;--gray-600:#525252;--gray-700:#404040;--gray-800:#262626;--gray-900:#171717;--blue:#0066FF;--green:#10B981;--red:#EF4444;--yellow:#F59E0B;--purple:#8B5CF6}
body{font-family:'Inter',-apple-system,BlinkMacSystemFont,sans-serif;background:var(--white);color:var(--black);-webkit-font-smoothing:antialiased;overflow-x:hidden}
.top-nav{background:var(--white);border-bottom:1px solid var(--gray-200);padding:.75rem 1rem;display:flex;justify-content:space-between;align-items:center;position:sticky;top:0;z-index:1000;box-shadow:0 2px 10px rgba(0,0,0,.02)}
.nav-left{display:flex;align-items:center;gap:1.5rem}
.logo{font-size:1.5rem;font-weight:900;letter-spacing:-1px;color:var(--black);cursor:pointer}
.cockpit-badge{padding:.4rem .9rem;background:linear-gradient(135deg,var(--blue),var(--purple));color:var(--white);border-radius:100px;font-size:.7rem;font-weight:800;letter-spacing:.5px}
.main-menu{display:flex;gap:.5rem}
.menu-item{padding:.6rem 1rem;background:transparent;border:none;color:var(--gray-600);font-weight:600;font-size:.85rem;border-radius:8px;cursor:pointer;transition:all .2s;font-family:'Inter',sans-serif}
.menu-item:hover{background:var(--gray-100);color:var(--black)}
.menu-item.active{background:var(--black);color:var(--white)}
.search-bar{position:relative;width:200px}
.search-input{width:100%;padding:.6rem .9rem .6rem 2.2rem;background:var(--gray-100);border:1px solid var(--gray-200);border-radius:8px;font-size:.85rem;font-weight:500;font-family:'Inter',sans-serif}
.search-input:focus{outline:none;border-color:var(--black)}
.search-icon{position:absolute;left:.8rem;top:50%;transform:translateY(-50%);font-size:.9rem;color:var(--gray-400)}
.nav-right{display:flex;align-items:center;gap:1rem}
.api-status{display:inline-flex;align-items:center;gap:.5rem;padding:.4rem .9rem;border-radius:100px;font-size:.7rem;font-weight:700}
.api-status.connected{background:rgba(16,185,129,.15);color:var(--green)}
.api-badge{display:inline-flex;align-items:center;gap:.3rem;padding:.3rem .7rem;background:rgba(139,92,246,.15);color:var(--purple);border-radius:100px;font-size:.65rem;font-weight:800}
.content-view{display:none}
.content-view.active{display:block}
.main-container{display:grid;grid-template-columns:320px 1fr 400px;gap:1rem;padding:1rem;min-height:calc(100vh - 70px)}
.panel{background:var(--white);border:1px solid var(--gray-200);border-radius:16px;overflow-y:auto;padding:1.5rem;max-height:calc(100vh - 90px)}
.panel-header{margin-bottom:1.5rem}
.panel-title{font-size:1.2rem;font-weight:900;letter-spacing:-.5px;margin-bottom:.5rem}
.panel-subtitle{font-size:.85rem;color:var(--gray-500);font-weight:600}
.watchlist-toggle{display:flex;gap:.5rem;margin-bottom:1rem;background:var(--gray-100);padding:.3rem;border-radius:8px}
.watchlist-toggle-btn{flex:1;padding:.5rem;background:transparent;border:none;font-size:.75rem;font-weight:700;border-radius:6px;cursor:pointer;transition:all .2s;font-family:'Inter',sans-serif;color:var(--gray-600)}
.watchlist-toggle-btn:hover{background:var(--gray-200)}
.watchlist-toggle-btn.active{background:var(--black);color:var(--white)}
.live-badge{display:inline-flex;align-items:center;gap:.5rem;padding:.5rem 1rem;background:var(--gray-100);border-radius:100px;font-size:.75rem;font-weight:700;margin-bottom:1.5rem}
.live-dot{width:6px;height:6px;background:var(--green);border-radius:50%;animation:pulse 2s infinite}
@keyframes pulse{0%,100%{opacity:1;transform:scale(1)}50%{opacity:.4;transform:scale(.8)}}
.stock-list{display:flex;flex-direction:column;gap:.75rem}
.stock-card{background:var(--gray-50);border:2px solid transparent;border-radius:14px;padding:1.25rem;cursor:pointer;transition:all .3s;position:relative}
.stock-card:hover{background:var(--white);border-color:var(--gray-300);transform:translateX(4px)}
.stock-card.active{background:var(--white);border-color:var(--black);transform:translateX(8px)}
.stock-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:.75rem}
.stock-symbol{font-size:1.3rem;font-weight:900;letter-spacing:-.7px}
.stock-badge{padding:.3rem .7rem;border-radius:6px;font-size:.75rem;font-weight:800}
.stock-badge.positive{background:var(--black);color:var(--white)}
.stock-badge.negative{background:var(--red);color:var(--white)}
.stock-name{font-size:.85rem;color:var(--gray-500);font-weight:600;margin-bottom:.75rem}
.stock-price-row{display:flex;justify-content:space-between;align-items:baseline}
.stock-price{font-size:1.5rem;font-weight:900;letter-spacing:-.8px}
.stock-change{font-size:.9rem;font-weight:700}
.stock-change.positive{color:var(--green)}
.stock-change.negative{color:var(--red)}
.chart-panel{background:var(--white);border:1px solid var(--gray-200);border-radius:16px;display:flex;flex-direction:column;overflow:hidden;max-height:calc(100vh - 90px)}
.chart-header{padding:2rem;border-bottom:1px solid var(--gray-200);overflow-y:auto;max-height:40vh}
.chart-meta{display:flex;align-items:center;gap:1rem;margin-bottom:1rem;flex-wrap:wrap}
.symbol-tag{padding:.5rem 1.2rem;background:var(--black);color:var(--white);border-radius:8px;font-weight:900;font-size:.95rem}
.exchange-tag{padding:.5rem 1.2rem;background:var(--gray-100);color:var(--gray-600);border-radius:8px;font-size:.85rem;font-weight:700}
.chart-title{font-size:1.8rem;font-weight:900;letter-spacing:-1.2px;margin-bottom:.5rem}
.price-display{display:flex;align-items:baseline;gap:1.5rem;flex-wrap:wrap;margin-bottom:1rem}
.price-large{font-size:2.5rem;font-weight:900;letter-spacing:-2px}
.price-change-badge{padding:.5rem 1rem;background:var(--gray-100);border-radius:10px;font-size:1.1rem;font-weight:900;letter-spacing:-.5px}
.price-change-badge.gain{background:var(--green);color:var(--white)}
.price-change-badge.loss{background:var(--red);color:var(--white)}
.chart-controls{padding:1rem 2rem;display:flex;gap:.5rem;border-bottom:1px solid var(--gray-200);overflow-x:auto}
.timeframe-btn{padding:.5rem 1rem;background:transparent;border:none;color:var(--gray-600);font-weight:700;font-size:.9rem;border-radius:6px;cursor:pointer;transition:all .2s;font-family:'Inter',sans-serif}
.timeframe-btn:hover{background:var(--gray-100);color:var(--black)}
.timeframe-btn.active{background:var(--black);color:var(--white)}
.chart-area{flex:1;padding:0;position:relative;min-height:400px}
.chart-canvas{width:100%;height:100%;cursor:crosshair}
.chart-tooltip{position:absolute;background:rgba(0,0,0,.9);color:white;padding:.75rem 1rem;border-radius:8px;font-size:.85rem;font-weight:600;pointer-events:none;opacity:0;transition:opacity .2s;z-index:100;white-space:nowrap}
.chart-tooltip.visible{opacity:1}
.greeks-section{background:linear-gradient(135deg,rgba(0,102,255,.05) 0%,white 100%);border:2px solid var(--blue);border-radius:16px;padding:1.5rem;margin-bottom:1.5rem}
.greeks-title{font-size:1.2rem;font-weight:900;margin-bottom:1.5rem;color:var(--blue)}
.greeks-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:1rem}
.greek-card{background:var(--white);border:1px solid var(--gray-200);border-radius:12px;padding:1.25rem;cursor:pointer;transition:all .3s}
.greek-card:hover{border-color:var(--blue);transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,102,255,.1)}
.greek-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:.75rem}
.greek-symbol{font-size:1.8rem;font-weight:900;color:var(--blue)}
.greek-value{font-size:1.4rem;font-weight:900}
.greek-label{font-size:.85rem;font-weight:700;color:var(--gray-600);margin-bottom:.5rem}
.greek-explanation{font-size:.75rem;color:var(--gray-500);line-height:1.5;font-weight:500}
.earnings-section{margin-top:2rem;padding-top:2rem;border-top:2px solid var(--gray-200)}
.earnings-section-title{font-size:1.1rem;font-weight:900;margin-bottom:1.5rem;display:flex;align-items:center;gap:.5rem}
.earnings-reports-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:1rem}
.earnings-report-card{background:var(--gray-50);border:1px solid var(--gray-200);border-radius:12px;padding:1.25rem;transition:all .3s}
.earnings-report-card:hover{border-color:var(--gray-400);transform:translateY(-2px)}
.report-company-header{display:flex;align-items:center;gap:.75rem;margin-bottom:1rem}
.report-logo{width:40px;height:40px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-weight:900;font-size:.9rem}
.report-company-name{font-size:1rem;font-weight:900}
.report-date{font-size:.75rem;color:var(--gray-500);font-weight:600}
.report-performance{display:flex;flex-direction:column;gap:.5rem}
.perf-row{display:flex;justify-content:space-between;align-items:center}
.perf-label{font-size:.8rem;color:var(--gray-500);font-weight:600}
.perf-value{font-size:1.1rem;font-weight:900}
.perf-value.positive{color:var(--green)}
.perf-value.negative{color:var(--red)}
.next-earnings-card{background:linear-gradient(135deg,rgba(245,158,11,.1) 0%,white 100%);border:2px solid var(--yellow);border-radius:12px;padding:1.25rem}
.next-earnings-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem}
.countdown-badge{padding:.5rem 1rem;background:var(--yellow);color:var(--black);border-radius:8px;font-size:.85rem;font-weight:900}
.earnings-date-info{font-size:.9rem;color:var(--gray-700);font-weight:600;margin-bottom:.5rem}
.earnings-time-info{font-size:.8rem;color:var(--gray-500);font-weight:600}
.modal{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.7);backdrop-filter:blur(10px);z-index:2000;padding:2rem;overflow-y:auto}
.modal.active{display:flex;align-items:flex-start;justify-content:center}
.modal-content{background:var(--white);border-radius:24px;max-width:800px;width:100%;margin:2rem auto;animation:modalSlide .4s ease}
@keyframes modalSlide{from{opacity:0;transform:translateY(50px)}to{opacity:1;transform:translateY(0)}}
.modal-header{padding:2rem;border-bottom:1px solid var(--gray-200);display:flex;justify-content:space-between;align-items:center}
.modal-title{font-size:1.8rem;font-weight:900;letter-spacing:-1px}
.modal-close{width:40px;height:40px;background:var(--gray-100);border:none;border-radius:50%;font-size:1.3rem;font-weight:900;cursor:pointer;transition:all .3s}
.modal-close:hover{background:var(--black);color:var(--white);transform:rotate(90deg)}
.modal-body{padding:2rem}
.greek-detail-symbol{font-size:4rem;font-weight:900;color:var(--blue);margin-bottom:1rem;text-align:center}
.greek-detail-section{margin-bottom:2rem}
.greek-detail-section h3{font-size:1.2rem;font-weight:900;margin-bottom:1rem;color:var(--black)}
.greek-detail-section p{font-size:1rem;line-height:1.8;color:var(--gray-700);margin-bottom:.75rem}
.greek-detail-section ul{margin-left:1.5rem;margin-top:.5rem}
.greek-detail-section li{font-size:.95rem;line-height:1.6;color:var(--gray-700);margin-bottom:.5rem}
.simulator-container{padding:2rem;max-width:1600px;margin:0 auto}
.simulator-grid{display:grid;grid-template-columns:400px 1fr;gap:2rem;margin-top:2rem}
.sim-section{background:var(--white);border:1px solid var(--gray-200);border-radius:16px;padding:2rem}
.sim-section-title{font-size:1.5rem;font-weight:900;margin-bottom:1.5rem}
.input-group-sim{margin-bottom:1.5rem}
.input-label-sim{font-size:.85rem;font-weight:700;color:var(--gray-600);text-transform:uppercase;letter-spacing:.5px;margin-bottom:.6rem;display:block}
.input-field-sim{width:100%;padding:1rem 1.2rem;background:var(--gray-50);border:2px solid var(--gray-200);border-radius:10px;font-size:1rem;font-weight:600;font-family:'Inter',sans-serif;transition:all .3s}
.input-field-sim:focus{outline:none;border-color:var(--black);background:var(--white)}
.timing-selector{display:flex;gap:.75rem}
.timing-btn{flex:1;padding:.75rem;background:var(--gray-100);border:2px solid var(--gray-200);border-radius:10px;font-size:.85rem;font-weight:700;cursor:pointer;transition:all .3s;font-family:'Inter',sans-serif}
.timing-btn.active{background:var(--blue);color:var(--white);border-color:var(--blue)}
.simulate-btn{width:100%;padding:1.2rem;background:linear-gradient(135deg,var(--blue),var(--purple));color:var(--white);border:none;border-radius:12px;font-size:1.1rem;font-weight:900;cursor:pointer;transition:all .3s;font-family:'Inter',sans-serif;margin-top:1rem}
.simulate-btn:hover{transform:translateY(-2px);box-shadow:0 10px 30px rgba(0,102,255,.3)}
.simulate-btn:disabled{opacity:.5;cursor:not-allowed}
.strategy-cards-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:1rem;margin-bottom:2rem}
.strategy-card{background:var(--gray-50);border:2px solid var(--gray-200);border-radius:16px;padding:1.5rem;text-align:center;transition:all .3s;position:relative}
.strategy-card.recommended{background:linear-gradient(135deg,rgba(16,185,129,.1) 0%,white 100%);border:3px solid var(--green);position:relative}
.strategy-card.recommended::before{content:"‚≠ê RECOMMAND√â";position:absolute;top:-12px;left:50%;transform:translateX(-50%);background:var(--green);color:white;padding:.3rem 1rem;border-radius:100px;font-size:.7rem;font-weight:800}
.strategy-card:hover{transform:translateY(-4px);box-shadow:0 10px 30px rgba(0,0,0,.1)}
.strategy-name{font-size:1rem;font-weight:900;margin-bottom:.5rem}
.strategy-type{font-size:.75rem;color:var(--gray-500);font-weight:600;margin-bottom:1rem}
.strategy-price{font-size:2rem;font-weight:900;color:var(--blue);margin-bottom:.5rem}
.strategy-details{font-size:.8rem;color:var(--gray-600);line-height:1.6}
.strategy-probability{display:inline-block;padding:.4rem .8rem;background:var(--green);color:var(--white);border-radius:6px;font-size:.75rem;font-weight:800;margin-top:.5rem}
.strategy-roi{display:inline-block;padding:.4rem .8rem;background:var(--blue);color:var(--white);border-radius:6px;font-size:.75rem;font-weight:800;margin-top:.5rem;margin-left:.5rem}
.strategy-explanation{background:var(--white);border:1px solid var(--gray-200);border-radius:12px;padding:1.5rem;margin-top:2rem}
.strategy-explanation-title{font-size:1.2rem;font-weight:900;margin-bottom:1rem}
.strategy-explanation-content{font-size:.9rem;line-height:1.8;color:var(--gray-700)}
.intelligence-panel{background:linear-gradient(135deg,rgba(139,92,246,.1) 0%,white 100%);border:2px solid var(--purple);border-radius:16px;padding:1.5rem;margin-bottom:2rem}
.intelligence-title{font-size:1.2rem;font-weight:900;margin-bottom:1rem;color:var(--purple);display:flex;align-items:center;gap:.5rem}
.intelligence-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:1rem}
.intel-card{background:var(--white);border:1px solid var(--gray-200);border-radius:10px;padding:1rem}
.intel-label{font-size:.75rem;color:var(--gray-500);font-weight:700;text-transform:uppercase;margin-bottom:.5rem}
.intel-value{font-size:1.3rem;font-weight:900;color:var(--black)}
.intel-value.positive{color:var(--green)}
.intel-value.negative{color:var(--red)}
.section-header{margin-bottom:3rem}
.section-title{font-size:3rem;font-weight:900;letter-spacing:-2px;margin-bottom:.75rem}
.section-subtitle{font-size:1.2rem;color:var(--gray-500);font-weight:500}
.calendar-container{padding:2rem}
.calendar-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:1rem}
.day-column{background:var(--white);border:1px solid var(--gray-200);border-radius:16px;padding:1.5rem;min-height:450px}
.day-header{font-size:1.1rem;font-weight:900;margin-bottom:.5rem}
.day-date{font-size:.9rem;color:var(--gray-500);font-weight:600;margin-bottom:1.5rem}
.earnings-list{display:flex;flex-direction:column;gap:1rem}
.earnings-card{background:var(--gray-50);border:1px solid var(--gray-200);border-radius:12px;padding:1rem;cursor:pointer;transition:all .3s}
.earnings-card:hover{border-color:var(--black);transform:translateY(-2px);background:var(--white)}
.company-header{display:flex;align-items:center;gap:.75rem;margin-bottom:.75rem}
.company-logo{width:40px;height:40px;background:var(--black);color:var(--white);border-radius:10px;display:flex;align-items:center;justify-content:center;font-weight:900;font-size:.9rem}
.company-ticker{font-size:1.1rem;font-weight:900;letter-spacing:-.5px}
.company-name{font-size:.85rem;color:var(--gray-500);font-weight:600}
.earnings-time{font-size:.75rem;color:var(--gray-600);font-weight:700;background:var(--gray-100);padding:.4rem .8rem;border-radius:6px;display:inline-block;margin-bottom:.5rem}
.beat-prediction{display:inline-flex;align-items:center;gap:.5rem;padding:.4rem .8rem;border-radius:6px;font-size:.75rem;font-weight:800}
.beat-prediction.high{background:rgba(16,185,129,.15);color:var(--green)}
.beat-prediction.medium{background:rgba(245,158,11,.15);color:var(--yellow)}
.beat-prediction.low{background:rgba(239,68,68,.15);color:var(--red)}
.beat-dot{width:8px;height:8px;border-radius:50%}
.beat-dot.high{background:var(--green)}
.beat-dot.medium{background:var(--yellow)}
.beat-dot.low{background:var(--red)}
.loading-spinner{display:inline-block;width:20px;height:20px;border:2px solid var(--gray-200);border-top-color:var(--black);border-radius:50%;animation:spin .8s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.analyzing-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.8);backdrop-filter:blur(10px);z-index:3000;display:none;align-items:center;justify-content:center}
.analyzing-overlay.active{display:flex}
.analyzing-content{text-align:center;color:var(--white)}
.analyzing-spinner{width:60px;height:60px;border:4px solid rgba(255,255,255,.2);border-top-color:var(--white);border-radius:50%;animation:spin 1s linear infinite;margin:0 auto 1.5rem}
.analyzing-text{font-size:1.3rem;font-weight:900;margin-bottom:.5rem}
.analyzing-subtext{font-size:.9rem;opacity:.7}
@media (max-width:1400px){.simulator-grid{grid-template-columns:1fr}.strategy-cards-grid{grid-template-columns:1fr}.intelligence-grid{grid-template-columns:1fr}}
@media (max-width:1200px){.main-container{grid-template-columns:1fr}.greeks-grid,.earnings-reports-grid{grid-template-columns:1fr}.calendar-grid{grid-template-columns:repeat(3,1fr)}}
@media (max-width:768px){.top-nav{flex-wrap:wrap}.nav-left,.nav-right{width:100%}.main-menu{overflow-x:auto}.search-bar{width:100%}.price-large{font-size:2rem}.section-title{font-size:2rem}.calendar-grid{grid-template-columns:1fr}}
::-webkit-scrollbar{width:8px;height:8px}
::-webkit-scrollbar-track{background:var(--gray-100)}
::-webkit-scrollbar-thumb{background:var(--gray-300);border-radius:4px}
::-webkit-scrollbar-thumb:hover{background:var(--black)}
</style>
</head>
<body>
<div class="top-nav">
<div class="nav-left">
<div class="logo" onclick="showView('cockpit')">Apex</div>
<span class="cockpit-badge">AI INTELLIGENCE</span>
<div class="main-menu">
<button class="menu-item active" onclick="showView('cockpit')">Analyse</button>
<button class="menu-item" onclick="showView('earnings')">R√©sultats</button>
<button class="menu-item" onclick="showView('simulator')">Simulateur</button>
</div>
</div>
<div class="nav-right">
<div class="search-bar">
<span class="search-icon">üîç</span>
<input type="text" class="search-input" placeholder="Rechercher..." id="searchInput">
</div>
<span class="api-badge">üß† Alpha Vantage</span>
<span class="api-status connected" id="apiStatus"><span>‚úì</span> Live</span>
</div>
</div>

<div id="cockpit-view" class="content-view active">
<div class="main-container">
<div class="panel">
<div class="panel-header">
<div class="panel-title">Watchlist</div>
<div class="panel-subtitle">Personnalisable</div>
</div>
<div class="watchlist-toggle">
<button class="watchlist-toggle-btn active" onclick="switchWatchlist('custom')">Ma Liste</button>
<button class="watchlist-toggle-btn" onclick="switchWatchlist('sp500')">S&P 500</button>
<button class="watchlist-toggle-btn" onclick="switchWatchlist('nasdaq')">NASDAQ</button>
</div>
<div class="live-badge"><div class="live-dot"></div>LIVE</div>
<div class="stock-list" id="stockList"></div>
</div>

<div class="chart-panel">
<div class="chart-header">
<div class="chart-meta">
<div class="symbol-tag" id="chartSymbol">AAPL</div>
<div class="exchange-tag" id="chartExchange">NASDAQ</div>
</div>
<div class="chart-title" id="chartTitle">Apple Inc.</div>
<div class="price-display">
<div class="price-large">$<span id="mainPrice">175.43</span></div>
<div class="price-change-badge gain" id="priceChange">+2.45 (+1.42%)</div>
</div>
</div>
<div class="chart-controls">
<button class="timeframe-btn" onclick="changeTimeframe('1D')">1J</button>
<button class="timeframe-btn active" onclick="changeTimeframe('1W')">1S</button>
<button class="timeframe-btn" onclick="changeTimeframe('1M')">1M</button>
<button class="timeframe-btn" onclick="changeTimeframe('3M')">3M</button>
<button class="timeframe-btn" onclick="changeTimeframe('1Y')">1A</button>
</div>
<div class="chart-area" id="chartArea">
<canvas id="mainChart" class="chart-canvas"></canvas>
<div class="chart-tooltip" id="chartTooltip"></div>
</div>
</div>

<div class="panel">
<div class="panel-header">
<div class="panel-title">Greeks & Analytics</div>
<div class="panel-subtitle">Cliquez pour d√©tails</div>
</div>
<div class="greeks-section">
<div class="greeks-title">üìä Greeks Analysis</div>
<div class="greeks-grid" id="greeksGrid"></div>
</div>
<div class="earnings-section">
<div class="earnings-section-title">üìÖ Next Earnings</div>
<div id="nextEarningsContainer"></div>
</div>
<div class="earnings-section">
<div class="earnings-section-title">üìà Past Earnings</div>
<div class="earnings-reports-grid" id="pastEarningsGrid"></div>
</div>
</div>
</div>
</div>

<div id="earnings-view" class="content-view">
<div class="calendar-container">
<div class="section-header">
<h1 class="section-title">Calendrier des R√©sultats</h1>
<p class="section-subtitle">Publications ¬∑ Pr√©dictions march√© ¬∑ Temps r√©el</p>
</div>
<div class="calendar-grid" id="earningsCalendar"></div>
</div>
</div>

<div id="simulator-view" class="content-view">
<div class="simulator-container">
<div class="section-header">
<h1 class="section-title">Simulateur Intelligence Options</h1>
<p class="section-subtitle">Analyse Alpha Vantage ¬∑ Historique Earnings ¬∑ Probabilit√©s ROI</p>
</div>
<div class="simulator-grid">
<div class="sim-section">
<h3 class="sim-section-title">Param√®tres</h3>
<div class="input-group-sim">
<label class="input-label-sim">Ticker</label>
<select class="input-field-sim" id="simTicker">
<option value="NVDA">NVDA - NVIDIA</option>
<option value="AAPL">AAPL - Apple</option>
<option value="TSLA">TSLA - Tesla</option>
<option value="MSFT">MSFT - Microsoft</option>
<option value="GOOGL">GOOGL - Alphabet</option>
<option value="AMZN">AMZN - Amazon</option>
<option value="META">META - Meta</option>
</select>
</div>
<div class="input-group-sim">
<label class="input-label-sim">Timing</label>
<div class="timing-selector">
<button class="timing-btn active" onclick="setTiming('before')">Avant Earnings</button>
<button class="timing-btn" onclick="setTiming('after')">Apr√®s Earnings</button>
</div>
</div>
<div class="input-group-sim">
<label class="input-label-sim">Montant (‚Ç¨)</label>
<input type="number" class="input-field-sim" id="simAmount" value="5000" min="100" step="100">
</div>
<button class="simulate-btn" onclick="runAdvancedSimulation()" id="simulateBtn">üöÄ Analyser avec AI</button>
</div>
<div class="sim-section">
<h3 class="sim-section-title">Strat√©gies Intelligentes</h3>
<div id="simulationResults">
<div style="text-align:center;padding:4rem;color:var(--gray-400)">
<p style="font-size:3rem;margin-bottom:1rem">üß†</p>
<p style="font-weight:600">Lancez l'analyse AI</p>
</div>
</div>
</div>
</div>
</div>
</div>

<div class="analyzing-overlay" id="analyzingOverlay">
<div class="analyzing-content">
<div class="analyzing-spinner"></div>
<div class="analyzing-text">Analyse en cours...</div>
<div class="analyzing-subtext">R√©cup√©ration donn√©es Alpha Vantage</div>
</div>
</div>

<div class="modal" id="greekModal">
<div class="modal-content">
<div class="modal-header">
<div class="modal-title" id="greekModalTitle">Delta (Œî)</div>
<button class="modal-close" onclick="closeGreekModal()">‚úï</button>
</div>
<div class="modal-body" id="greekModalBody"></div>
</div>
</div>

<script>
const API_CONFIG={
finnhub:'d43qmg1r01qge0cv35mgd43qmg1r01qge0cv35n0',
alphaVantage:'ELRTA26TBU3LJK1C',
useRealAPI:true,
cache:{}
};

const state={
currentStock:null,
stocks:[],
watchlistMode:'custom',
simulatorTiming:'before',
chartData:{points:[],min:0,max:0},
customWatchlist:['AAPL','MSFT','NVDA','TSLA','GOOGL','AMZN','META'],
earningsData:{}
};

const sp500Stocks=[
{symbol:'^GSPC',name:'S&P 500 Index',isIndex:true},
{symbol:'AAPL',name:'Apple'},
{symbol:'MSFT',name:'Microsoft'},
{symbol:'GOOGL',name:'Alphabet'},
{symbol:'AMZN',name:'Amazon'},
{symbol:'NVDA',name:'NVIDIA'},
{symbol:'TSLA',name:'Tesla'},
{symbol:'META',name:'Meta'},
{symbol:'BRK.B',name:'Berkshire'},
{symbol:'UNH',name:'UnitedHealth'},
{symbol:'JNJ',name:'Johnson & Johnson'}
];

const nasdaqStocks=[
{symbol:'^IXIC',name:'NASDAQ Composite',isIndex:true},
{symbol:'AAPL',name:'Apple'},
{symbol:'MSFT',name:'Microsoft'},
{symbol:'GOOGL',name:'Alphabet'},
{symbol:'AMZN',name:'Amazon'},
{symbol:'NVDA',name:'NVIDIA'},
{symbol:'TSLA',name:'Tesla'},
{symbol:'META',name:'Meta'},
{symbol:'AVGO',name:'Broadcom'},
{symbol:'COST',name:'Costco'},
{symbol:'CSCO',name:'Cisco'}
];

const initialStocks=[
{symbol:'AAPL',name:'Apple Inc.',price:175.43,change:1.42,basePrice:175.43,nextEarnings:'2025-02-01',nextEarningsTime:'Post Market'},
{symbol:'MSFT',name:'Microsoft',price:378.91,change:.87,basePrice:378.91,nextEarnings:'2025-01-28',nextEarningsTime:'Post Market'},
{symbol:'NVDA',name:'NVIDIA',price:495.22,change:3.78,basePrice:495.22,nextEarnings:'2025-02-26',nextEarningsTime:'Post Market'},
{symbol:'TSLA',name:'Tesla',price:238.45,change:-1.23,basePrice:238.45,nextEarnings:'2025-01-29',nextEarningsTime:'Post Market'},
{symbol:'GOOGL',name:'Alphabet',price:141.80,change:-.45,basePrice:141.80,nextEarnings:'2025-02-04',nextEarningsTime:'Post Market'},
{symbol:'AMZN',name:'Amazon',price:151.94,change:2.15,basePrice:151.94,nextEarnings:'2025-02-01',nextEarningsTime:'Post Market'},
{symbol:'META',name:'Meta',price:352.17,change:1.89,basePrice:352.17,nextEarnings:'2025-02-05',nextEarningsTime:'Post Market'}
];

const greeksInfo={
delta:{symbol:'Œî',name:'Delta',description:'Le Delta mesure la sensibilit√© du prix d\'une option aux variations du prix de l\'action sous-jacente.',impact:'Pour chaque dollar de variation du prix de l\'action, le prix de l\'option varie d\'environ Delta dollars.',trading:['Call options: Delta entre 0 et 1','Put options: Delta entre -1 et 0','ATM options: Delta proche de 0.5','ITM options: Delta proche de 1'],strategy:['Delta √©lev√© (>0.7): Position directionnelle forte','Delta faible (<0.3): Position sp√©culative','Hedging: Utiliser Delta pour neutraliser le risque','Portfolio Delta: Somme des deltas pour exposition totale']},
gamma:{symbol:'Œì',name:'Gamma',description:'Le Gamma mesure le taux de changement du Delta par rapport aux variations du prix de l\'action.',impact:'Un Gamma √©lev√© signifie que le Delta change rapidement, augmentant le risque et le potentiel.',trading:['Gamma maximal pour options ATM','Gamma diminue pour ITM et OTM','Options court terme: Gamma plus √©lev√©','Long Gamma: Profit de la volatilit√©'],strategy:['Position longue: B√©n√©ficie des mouvements importants','Position courte: Perte si mouvement important','Gamma scalping: Trading Delta hedging','Attention au Gamma en approche expiration']},
theta:{symbol:'Œò',name:'Theta',description:'Le Theta mesure la d√©croissance temporelle de la valeur d\'une option.',impact:'Chaque jour qui passe, l\'option perd environ Theta dollars de valeur.',trading:['Theta toujours n√©gatif pour acheteurs','Theta positif pour vendeurs','Acc√©l√©ration proche expiration','ATM options: Theta le plus √©lev√©'],strategy:['Vente options: Profiter du decay','Achat options: Minimiser temps d√©tention','Theta gang: Strat√©gies courtes options','√âviter positions longues proches expiration']},
vega:{symbol:'V',name:'Vega',description:'Le Vega mesure la sensibilit√© du prix d\'une option aux variations de la volatilit√© implicite.',impact:'Pour chaque point de hausse de l\'IV, le prix de l\'option augmente d\'environ Vega dollars.',trading:['Vega positif: Long options','Vega n√©gatif: Short options','ATM: Vega le plus √©lev√©','IV √©lev√©e avant earnings'],strategy:['Long avant earnings: Profiter hausse IV','Short apr√®s earnings: IV Crush','Vega hedging: Spreads calendaires','Surveiller VIX pour timing entr√©es']}
};

async function fetchAlphaVantageEarnings(symbol){
const cacheKey=`earnings_${symbol}`;
if(API_CONFIG.cache[cacheKey]&&Date.now()-API_CONFIG.cache[cacheKey].timestamp<86400000){
return API_CONFIG.cache[cacheKey].data;
}
try{
const response=await fetch(`https://www.alphavantage.co/query?function=EARNINGS&symbol=${symbol}&apikey=${API_CONFIG.alphaVantage}`);
const data=await response.json();
if(data.quarterlyEarnings){
API_CONFIG.cache[cacheKey]={data:data.quarterlyEarnings,timestamp:Date.now()};
return data.quarterlyEarnings;
}
}catch(e){
console.warn('Alpha Vantage Error:',e);
}
return null;
}

async function fetchAlphaVantageOverview(symbol){
const cacheKey=`overview_${symbol}`;
if(API_CONFIG.cache[cacheKey]&&Date.now()-API_CONFIG.cache[cacheKey].timestamp<86400000){
return API_CONFIG.cache[cacheKey].data;
}
try{
const response=await fetch(`https://www.alphavantage.co/query?function=OVERVIEW&symbol=${symbol}&apikey=${API_CONFIG.alphaVantage}`);
const data=await response.json();
if(data.Symbol){
API_CONFIG.cache[cacheKey]={data:data,timestamp:Date.now()};
return data;
}
}catch(e){
console.warn('Alpha Vantage Error:',e);
}
return null;
}

function analyzeEarningsHistory(earnings){
if(!earnings||earnings.length<2)return null;
const recent=earnings.slice(0,4);
let beats=0;
let totalMove=0;
recent.forEach(e=>{
const actual=parseFloat(e.reportedEPS);
const estimate=parseFloat(e.estimatedEPS);
if(actual>estimate)beats++;
if(e.surprise)totalMove+=parseFloat(e.surprise);
});
const beatRate=(beats/recent.length)*100;
const avgMove=totalMove/recent.length;
return{
beatRate:beatRate,
beats:beats,
total:recent.length,
avgMove:avgMove,
trend:beats>=3?'strong':beats>=2?'moderate':'weak'
};
}

function calculateAdvancedStrategy(stock,earningsAnalysis,overview,timing,amount){
const price=stock.price;
const beatRate=earningsAnalysis?.beatRate||50;
const avgMove=Math.abs(earningsAnalysis?.avgMove||5);
const beta=parseFloat(overview?.Beta)||1.0;
const strategies=[];

if(timing==='before'){
const ivEstimate=avgMove*2;
const callPremium=price*(ivEstimate/100);
const straddle Premium=callPremium*1.6;
const spreadPremium=callPremium*0.6;

strategies.push({
name:beatRate>70?'Long Call ITM':'Long Call ATM',
type:'Anticipation haussi√®re',
premium:callPremium.toFixed(2),
contracts:Math.floor(amount/(callPremium*100)),
breakeven:(price*(1+ivEstimate/100)).toFixed(2),
movement:`+${ivEstimate.toFixed(0)}%`,
probability:beatRate,
roi:avgMove*10,
recommended:beatRate>60&&stock.change>0,
explanation:`Historique: ${earningsAnalysis?.beats}/${earningsAnalysis?.total} beats (${beatRate.toFixed(0)}%). Mouvement moyen: ${avgMove.toFixed(1)}%. ${beatRate>70?'Beat rate √©lev√© ‚Üí ITM plus s√ªr':'Beat rate mod√©r√© ‚Üí ATM optimal'}`
});

strategies.push({
name:'Long Straddle',
type:'Haute volatilit√©',
premium:straddlePremium.toFixed(2),
contracts:Math.floor(amount/(straddlePremium*100)),
breakeven:`¬±${(ivEstimate*1.2).toFixed(0)}%`,
movement:`¬±${(avgMove*1.5).toFixed(0)}%`,
probability:avgMove>8?75:55,
roi:avgMove*15,
recommended:avgMove>8||beta>1.5,
explanation:`Mouvement historique moyen: ${avgMove.toFixed(1)}%. ${avgMove>8?'Volatilit√© √©lev√©e ‚Üí Straddle optimal':'Volatilit√© mod√©r√©e ‚Üí Risqu√©'}. Beta ${beta.toFixed(2)} ${beta>1.5?'(tr√®s volatile)':''}`
});

strategies.push({
name:'Bull Call Spread',
type:'Hausse contr√¥l√©e',
premium:spreadPremium.toFixed(2),
contracts:Math.floor(amount/(spreadPremium*100)),
breakeven:(price*(1+ivEstimate*0.5/100)).toFixed(2),
movement:`+${(ivEstimate*0.7).toFixed(0)}%`,
probability:beatRate*0.85,
roi:avgMove*8,
recommended:beatRate>50&&beatRate<75&&stock.change>-1,
explanation:`Co√ªt r√©duit vs Call simple. Optimal si beat attendu mais mouvement mod√©r√©. Historique: ${beatRate.toFixed(0)}% beats.`
});
}else{
const ivCrush=avgMove*0.6;
strategies.push({
name:'Short Straddle',
type:'IV Crush',
premium:(price*ivCrush/100).toFixed(2),
contracts:Math.floor(amount/(price*ivCrush/100*100)),
breakeven:`¬±${ivCrush.toFixed(0)}%`,
movement:'<3%',
probability:Math.abs(stock.change)<2?70:45,
roi:ivCrush*12,
recommended:Math.abs(stock.change)<2&&avgMove>6,
explanation:`IV Crush moyen: -${ivCrush.toFixed(0)}%. ${Math.abs(stock.change)<2?'Prix stable ‚Üí Optimal':'Prix volatile ‚Üí Risqu√©'}. Apr√®s earnings, IV baisse drastiquement.`
});

strategies.push({
name:'Iron Condor',
type:'Range trading',
premium:(price*ivCrush*0.5/100).toFixed(2),
contracts:Math.floor(amount/(price*ivCrush*0.5/100*100)),
breakeven:`¬±${(ivCrush*0.8).toFixed(0)}%`,
movement:`¬±${(ivCrush*0.6).toFixed(0)}%`,
probability:65,
roi:ivCrush*8,
recommended:Math.abs(stock.change)<1,
explanation:`Risque d√©fini. Profit si prix reste dans range apr√®s earnings. Historique: mouvement moyen ${avgMove.toFixed(1)}%.`
});

strategies.push({
name:'Long Call OTM',
type:'Continuation',
premium:(price*0.02).toFixed(2),
contracts:Math.floor(amount/(price*0.02*100)),
breakeven:(price*1.08).toFixed(2),
movement:'+8%',
probability:beatRate>75?55:35,
roi:avgMove*20,
recommended:stock.change>3&&beatRate>70,
explanation:`Moins cher, profit si forte continuation. ${beatRate>75?'Beat rate √©lev√© ‚Üí Probabilit√© acceptable':'Beat rate faible ‚Üí Tr√®s sp√©culatif'}.`
});
}

strategies.sort((a,b)=>{
if(a.recommended&&!b.recommended)return -1;
if(!a.recommended&&b.recommended)return 1;
return b.probability-a.probability;
});

return strategies;
}

function calculateGreeks(stock){
const S=stock.price;
const T=30/365;
const sigma=Math.abs(stock.change)/100*Math.sqrt(252);
const delta=stock.change>=0?.55+Math.random()*.15:.45-Math.random()*.15;
const gamma=.03+Math.random()*.02;
const theta=-(S*sigma*gamma)/(2*Math.sqrt(T));
const vega=S*Math.sqrt(T)*gamma;
return{
delta:delta.toFixed(3),
gamma:gamma.toFixed(4),
theta:theta.toFixed(2),
vega:vega.toFixed(2)
};
}

function renderGreeks(){
if(!state.currentStock)return;
const greeks=calculateGreeks(state.currentStock);
const container=document.getElementById('greeksGrid');
const greeksData=[
{symbol:'Œî',name:'Delta',value:greeks.delta,key:'delta'},
{symbol:'Œì',name:'Gamma',value:greeks.gamma,key:'gamma'},
{symbol:'Œò',name:'Theta',value:greeks.theta,key:'theta'},
{symbol:'V',name:'Vega',value:greeks.vega,key:'vega'}
];
container.innerHTML=greeksData.map(g=>`
<div class="greek-card" onclick="openGreekModal('${g.key}')">
<div class="greek-header">
<div class="greek-symbol">${g.symbol}</div>
<div class="greek-value">${g.value}</div>
</div>
<div class="greek-label">${g.name}</div>
<div class="greek-explanation">Cliquez pour d√©tails</div>
</div>
`).join('');
}

function renderNextEarnings(){
if(!state.currentStock||!state.currentStock.nextEarnings)return;
const container=document.getElementById('nextEarningsContainer');
const earnings=state.currentStock.nextEarnings;
const earningsDate=new Date(earnings);
const now=new Date();
const diff=earningsDate-now;
const days=Math.floor(diff/(1000*60*60*24));
const hours=Math.floor((diff%(1000*60*60*24))/(1000*60*60));

let countdownText;
if(days>14)countdownText=`Dans ${Math.floor(days/7)} semaines`;
else if(days>7)countdownText='Dans 2 semaines';
else if(days>1)countdownText=`Dans ${days} jours`;
else if(days===1)countdownText='Demain';
else if(hours>0)countdownText=`Dans ${hours}h`;
else countdownText='Aujourd\'hui';

container.innerHTML=`
<div class="next-earnings-card">
<div class="next-earnings-header">
<div>
<div class="report-company-name">${state.currentStock.symbol}</div>
<div class="report-date">Prochains r√©sultats</div>
</div>
<div class="countdown-badge">${countdownText}</div>
</div>
<div class="earnings-date-info">üìÖ ${earningsDate.toLocaleDateString('fr-FR',{day:'numeric',month:'long',year:'numeric'})}</div>
<div class="earnings-time-info">üïê ${state.currentStock.nextEarningsTime||'Post Market'}</div>
</div>
`;
}

async function renderPastEarnings(){
if(!state.currentStock)return;
const container=document.getElementById('pastEarningsGrid');
const earnings=await fetchAlphaVantageEarnings(state.currentStock.symbol);

if(!earnings||earnings.length===0){
container.innerHTML='<div style="grid-column:1/-1;text-align:center;padding:1rem;color:var(--gray-400);font-size:0.85rem">Chargement donn√©es...</div>';
return;
}

const recent=earnings.slice(0,4);
container.innerHTML=recent.map(e=>{
const actual=parseFloat(e.reportedEPS);
const estimate=parseFloat(e.estimatedEPS);
const beat=actual>estimate;
const surprise=e.surprise?parseFloat(e.surprise):0;
const date=new Date(e.fiscalDateEnding);
return `
<div class="earnings-report-card">
<div class="report-company-header">
<div class="report-logo" style="background:var(--black)">${state.currentStock.symbol[0]}</div>
<div>
<div class="report-company-name">${state.currentStock.symbol}</div>
<div class="report-date">${date.toLocaleDateString('fr-FR',{month:'short',day:'numeric'})}</div>
</div>
</div>
<div class="report-performance">
<div class="perf-row">
<span class="perf-label">EPS R√©el</span>
<span class="perf-value ${beat?'positive':'negative'}">${beat?'‚ñ≤':'‚ñº'} $${actual.toFixed(2)}</span>
</div>
<div class="perf-row">
<span class="perf-label">EPS Estim√©</span>
<span class="perf-value">$${estimate.toFixed(2)}</span>
</div>
<div class="perf-row">
<span class="perf-label">Surprise</span>
<span class="perf-value ${surprise>=0?'positive':'negative'}">${surprise>=0?'+':''}${surprise.toFixed(1)}%</span>
</div>
</div>
</div>
`;
}).join('');
}

function openGreekModal(key){
const info=greeksInfo[key];
if(!info)return;
document.getElementById('greekModalTitle').textContent=`${info.name} (${info.symbol})`;
document.getElementById('greekModalBody').innerHTML=`
<div class="greek-detail-symbol">${info.symbol}</div>
<div class="greek-detail-section">
<h3>üìñ Description</h3>
<p>${info.description}</p>
</div>
<div class="greek-detail-section">
<h3>üí• Impact sur la Valeur</h3>
<p>${info.impact}</p>
</div>
<div class="greek-detail-section">
<h3>üìä Implications Trading</h3>
<ul>${info.trading.map(t=>`<li>${t}</li>`).join('')}</ul>
</div>
<div class="greek-detail-section">
<h3>üéØ Strat√©gies d'Investissement</h3>
<ul>${info.strategy.map(s=>`<li>${s}</li>`).join('')}</ul>
</div>
`;
document.getElementById('greekModal').classList.add('active');
document.body.style.overflow='hidden';
}

function closeGreekModal(){
document.getElementById('greekModal').classList.remove('active');
document.body.style.overflow='auto';
}

async function fetchRealStockPrice(symbol){
try{
const response=await fetch(`https://finnhub.io/api/v1/quote?symbol=${symbol}&token=${API_CONFIG.finnhub}`);
const data=await response.json();
if(data.c)return{price:data.c,change:data.dp,high:data.h,low:data.l,open:data.o};
}catch(e){
console.warn('Finnhub Error:',e);
}
return null;
}

async function updateStockPrices(){
for(let stock of state.stocks){
if(stock.isIndex)continue;
const realData=await fetchRealStockPrice(stock.symbol);
if(realData){
stock.price=realData.price;
stock.change=realData.change;
}
}
}

function drawChart(){
if(!state.currentStock)return;
const canvas=document.getElementById('mainChart');
if(!canvas)return;
const ctx=canvas.getContext('2d');
const container=canvas.parentElement;
canvas.width=container.offsetWidth;
canvas.height=container.offsetHeight;

const points=60;
const data=[];
const base=state.currentStock.basePrice||state.currentStock.price;
const current=state.currentStock.price;

for(let i=0;i<points;i++){
const progress=i/(points-1);
const trend=base+(current-base)*progress;
const noise=(Math.random()-.5)*(current*.008);
data.push(trend+noise);
}

state.chartData.points=data;
const padLeft=60;
const padRight=80;
const padTop=40;
const padBottom=40;
const width=canvas.width-padLeft-padRight;
const height=canvas.height-padTop-padBottom;
const min=Math.min(...data)*.998;
const max=Math.max(...data)*1.002;
const range=max-min;
state.chartData.min=min;
state.chartData.max=max;

ctx.fillStyle='#FAFAFA';
ctx.fillRect(0,0,canvas.width,canvas.height);
ctx.strokeStyle='#E5E5E5';
ctx.lineWidth=1;

for(let i=0;i<=5;i++){
const y=padTop+(height/5)*i;
ctx.beginPath();
ctx.moveTo(padLeft,y);
ctx.lineTo(canvas.width-padRight,y);
ctx.stroke();
const priceValue=max-(range/5)*i;
ctx.fillStyle='#737373';
ctx.font='600 12px Inter';
ctx.textAlign='left';
ctx.fillText(`$${priceValue.toFixed(2)}`,canvas.width-padRight+10,y+4);
}

const grad=ctx.createLinearGradient(0,padTop,0,canvas.height-padBottom);
grad.addColorStop(0,state.currentStock.change>=0?'rgba(16,185,129,0.2)':'rgba(239,68,68,0.2)');
grad.addColorStop(1,'rgba(0,0,0,0)');
ctx.fillStyle=grad;
ctx.beginPath();
ctx.moveTo(padLeft,canvas.height-padBottom);
data.forEach((price,i)=>{
const x=padLeft+(width/(points-1))*i;
const y=padTop+height-((price-min)/range*height);
ctx.lineTo(x,y);
});
ctx.lineTo(canvas.width-padRight,canvas.height-padBottom);
ctx.closePath();
ctx.fill();

ctx.strokeStyle=state.currentStock.change>=0?'#10B981':'#EF4444';
ctx.lineWidth=3;
ctx.lineJoin='round';
ctx.lineCap='round';
ctx.beginPath();
data.forEach((price,i)=>{
const x=padLeft+(width/(points-1))*i;
const y=padTop+height-((price-min)/range*height);
if(i===0)ctx.moveTo(x,y);
else ctx.lineTo(x,y);
});
ctx.stroke();

const closeY=padTop+height-((data[data.length-1]-min)/range*height);
ctx.strokeStyle='#999';
ctx.lineWidth=1;
ctx.setLineDash([5,5]);
ctx.beginPath();
ctx.moveTo(padLeft,closeY);
ctx.lineTo(canvas.width-padRight,closeY);
ctx.stroke();
ctx.setLineDash([]);

ctx.fillStyle='#737373';
ctx.font='600 12px Inter';
ctx.textAlign='center';
const timeLabels=['10:00','12:00','14:00','16:00','20:00'];
timeLabels.forEach((label,i)=>{
const x=padLeft+(width/(timeLabels.length-1))*i;
ctx.fillText(label,x,canvas.height-15);
});
}

function setupChartInteraction(){
const canvas=document.getElementById('mainChart');
const tooltip=document.getElementById('chartTooltip');
const area=document.getElementById('chartArea');
area.addEventListener('mousemove',(e)=>{
const rect=canvas.getBoundingClientRect();
const x=e.clientX-rect.left;
const y=e.clientY-rect.top;
const padLeft=60;
const padRight=80;
const padTop=40;
const padBottom=40;
const width=canvas.width-padLeft-padRight;
const height=canvas.height-padTop-padBottom;
if(x>padLeft&&x<canvas.width-padRight&&y>padTop&&y<canvas.height-padBottom){
const dataIndex=Math.floor(((x-padLeft)/width)*state.chartData.points.length);
const price=state.chartData.points[dataIndex];
if(price){
const hour=10+Math.floor((dataIndex/state.chartData.points.length)*10);
const minute=Math.floor((dataIndex%6)*10);
tooltip.innerHTML=`<div><strong>$${price.toFixed(2)} USD</strong></div><div style="font-size:0.75rem;opacity:0.8;margin-top:0.25rem">${hour}:${minute.toString().padStart(2,'0')}</div>`;
tooltip.style.left=`${e.clientX-rect.left+15}px`;
tooltip.style.top=`${e.clientY-rect.top-40}px`;
tooltip.classList.add('visible');
}
}else{
tooltip.classList.remove('visible');
}
});
area.addEventListener('mouseleave',()=>{
tooltip.classList.remove('visible');
});
}

function setTiming(timing){
state.simulatorTiming=timing;
document.querySelectorAll('.timing-btn').forEach(btn=>btn.classList.remove('active'));
event.target.classList.add('active');
}

async function runAdvancedSimulation(){
const ticker=document.getElementById('simTicker').value;
const amount=parseFloat(document.getElementById('simAmount').value);
const timing=state.simulatorTiming;
const stock=state.stocks.find(s=>s.symbol===ticker);
if(!stock)return;

const btn=document.getElementById('simulateBtn');
btn.disabled=true;
btn.textContent='‚è≥ Analyse...';
document.getElementById('analyzingOverlay').classList.add('active');

try{
const earnings=await fetchAlphaVantageEarnings(ticker);
const overview=await fetchAlphaVantageOverview(ticker);
const earningsAnalysis=analyzeEarningsHistory(earnings);

setTimeout(()=>{
const strategies=calculateAdvancedStrategy(stock,earningsAnalysis,overview,timing,amount);
displayAdvancedStrategies(strategies,timing,stock,earningsAnalysis,overview);
document.getElementById('analyzingOverlay').classList.remove('active');
btn.disabled=false;
btn.textContent='üöÄ Analyser avec AI';
},2000);
}catch(e){
console.error('Simulation error:',e);
document.getElementById('analyzingOverlay').classList.remove('active');
btn.disabled=false;
btn.textContent='üöÄ Analyser avec AI';
}
}

function displayAdvancedStrategies(strategies,timing,stock,earningsAnalysis,overview){
const container=document.getElementById('simulationResults');
const timingText=timing==='before'?'üîÆ Avant Earnings':'‚úÖ Apr√®s Earnings';
const beatRate=earningsAnalysis?.beatRate||50;
const avgMove=earningsAnalysis?.avgMove||5;
const beta=parseFloat(overview?.Beta)||1.0;

container.innerHTML=`
<div class="intelligence-panel">
<div class="intelligence-title">üß† Intelligence Analysis</div>
<div class="intelligence-grid">
<div class="intel-card">
<div class="intel-label">Beat Rate</div>
<div class="intel-value ${beatRate>70?'positive':beatRate>50?'':'negative'}">${beatRate.toFixed(0)}%</div>
</div>
<div class="intel-card">
<div class="intel-label">Mouvement Moyen</div>
<div class="intel-value">${avgMove.toFixed(1)}%</div>
</div>
<div class="intel-card">
<div class="intel-label">Beta</div>
<div class="intel-value">${beta.toFixed(2)}</div>
</div>
<div class="intel-card">
<div class="intel-label">Tendance</div>
<div class="intel-value ${earningsAnalysis?.trend==='strong'?'positive':''}">
${earningsAnalysis?.trend==='strong'?'Forte':earningsAnalysis?.trend==='moderate'?'Mod√©r√©e':'Faible'}
</div>
</div>
</div>
</div>

<div style="background:linear-gradient(135deg,rgba(0,102,255,0.1) 0%,white 100%);border:2px solid var(--blue);border-radius:16px;padding:1.5rem;margin-bottom:2rem">
<h4 style="font-size:1.2rem;font-weight:900;margin-bottom:0.5rem">${timingText}</h4>
<p style="font-size:0.9rem;color:var(--gray-600)">${stock.symbol} ¬∑ $${stock.price.toFixed(2)} ¬∑ ${stock.change>=0?'+':''}${stock.change.toFixed(2)}%</p>
</div>

<div class="strategy-cards-grid">
${strategies.map(s=>`
<div class="strategy-card ${s.recommended?'recommended':''}">
<div class="strategy-name">${s.name}</div>
<div class="strategy-type">${s.type}</div>
<div class="strategy-price">${s.premium} USD</div>
<div class="strategy-details">
<strong>Prime:</strong> $${s.premium}<br>
<strong>Contrats:</strong> ${s.contracts}<br>
<strong>Break-even:</strong> $${s.breakeven}<br>
<strong>Mouvement:</strong> ${s.movement}
</div>
<div style="margin-top:0.75rem">
<span class="strategy-probability">${s.probability.toFixed(0)}% succ√®s</span>
<span class="strategy-roi">ROI: ${s.roi.toFixed(0)}%</span>
</div>
</div>
`).join('')}
</div>

<div class="strategy-explanation">
<div class="strategy-explanation-title">üí° Explications D√©taill√©es</div>
<div class="strategy-explanation-content">
${strategies.map(s=>`<p style="margin-bottom:1rem"><strong>${s.name}:</strong> ${s.explanation}</p>`).join('')}
</div>
</div>
`;
}

async function fetchEarningsCalendar(){
try{
const today=new Date();
const nextWeek=new Date(today.getTime()+14*24*60*60*1000);
const fromDate=today.toISOString().split('T')[0];
const toDate=nextWeek.toISOString().split('T')[0];
const response=await fetch(`https://finnhub.io/api/v1/calendar/earnings?from=${fromDate}&to=${toDate}&token=${API_CONFIG.finnhub}`);
const data=await response.json();
if(data.earningsCalendar){
const weekdays=data.earningsCalendar.filter(e=>{
const date=new Date(e.date);
const day=date.getDay();
return day>=1&&day<=5;
});
renderEarningsCalendar(weekdays);
}
}catch(error){
console.warn('Earnings API Error:',error);
}
}

function renderEarningsCalendar(earnings){
const container=document.getElementById('earningsCalendar');
const byDay={};
const weekdays=['Lundi','Mardi','Mercredi','Jeudi','Vendredi'];
weekdays.forEach(day=>byDay[day]=[]);
earnings.forEach(e=>{
const date=new Date(e.date);
const dayIndex=date.getDay();
if(dayIndex>=1&&dayIndex<=5){
const dayName=weekdays[dayIndex-1];
byDay[dayName].push(e);
}
});
container.innerHTML=weekdays.map((dayName,idx)=>{
const dayEarnings=byDay[dayName];
const date=new Date();
date.setDate(date.getDate()+(idx-date.getDay()+1));
const dateStr=date.toLocaleDateString('fr-FR',{day:'numeric',month:'short'});
return `
<div class="day-column">
<div class="day-header">${dayName}</div>
<div class="day-date">${dateStr}</div>
<div class="earnings-list">
${dayEarnings.length>0?dayEarnings.slice(0,5).map(e=>{
const beatProb=75+Math.random()*20;
const beatClass=beatProb>80?'high':beatProb>60?'medium':'low';
return `
<div class="earnings-card">
<div class="company-header">
<div class="company-logo">${e.symbol[0]}</div>
<div>
<div class="company-ticker">${e.symbol}</div>
<div class="company-name">${e.symbol}</div>
</div>
</div>
${e.hour?`<div class="earnings-time">üïê ${e.hour}</div>`:'<div class="earnings-time">Pre Market</div>'}
<div class="beat-prediction ${beatClass}">
<div class="beat-dot ${beatClass}"></div>
${beatProb.toFixed(0)}% beats
</div>
</div>
`;
}).join(''):'<div style="color:var(--gray-400);font-size:0.85rem;text-align:center;padding:1rem">Aucune publication</div>'}
</div>
</div>
`;
}).join('');
}

function switchWatchlist(mode){
state.watchlistMode=mode;
document.querySelectorAll('.watchlist-toggle-btn').forEach(btn=>btn.classList.remove('active'));
event.target.classList.add('active');

let symbols;
if(mode==='sp500')symbols=sp500Stocks;
else if(mode==='nasdaq')symbols=nasdaqStocks;
else symbols=state.customWatchlist.map(s=>({symbol:s,name:s}));

state.stocks=symbols.map(s=>{
const existing=state.stocks.find(st=>st.symbol===s.symbol);
if(existing)return existing;
const init=initialStocks.find(st=>st.symbol===s.symbol);
if(s.isIndex){
return{...s,price:mode==='sp500'?5800+Math.random()*100:18000+Math.random()*200,change:(Math.random()-.5)*2,basePrice:mode==='sp500'?5800:18000,isIndex:true};
}
return init||{symbol:s.symbol,name:s.name,price:100,change:0,basePrice:100};
});

if(state.stocks[0]){
state.currentStock=state.stocks[0];
}
renderStockList();
updateChartInfo();
renderGreeks();
renderNextEarnings();
renderPastEarnings();
drawChart();
}

function init(){
state.stocks=JSON.parse(JSON.stringify(initialStocks));
state.currentStock=state.stocks[0];
renderStockList();
updateChartInfo();
renderGreeks();
renderNextEarnings();
renderPastEarnings();
drawChart();
setupChartInteraction();
fetchEarningsCalendar();
startRealTimeUpdates();
document.getElementById('searchInput').addEventListener('input',handleSearch);
console.log('‚úÖ Apex AI Intelligence v8.0');
console.log('üß† Alpha Vantage Active');
}

function startRealTimeUpdates(){
setInterval(async()=>{
await updateStockPrices();
renderStockList();
updateChartInfo();
renderGreeks();
drawChart();
},10000);
}

function renderStockList(){
const list=document.getElementById('stockList');
list.innerHTML=state.stocks.map((stock,idx)=>{
const isActive=state.currentStock&&state.currentStock.symbol===stock.symbol;
const changeClass=stock.change>=0?'positive':'negative';
const changeIcon=stock.change>=0?'‚Üó':'‚Üò';
return `
<div class="stock-card ${isActive?'active':''}" onclick="selectStock(${idx})">
<div class="stock-header">
<div class="stock-symbol">${stock.symbol}</div>
<div class="stock-badge ${changeClass}">${changeIcon} ${Math.abs(stock.change).toFixed(2)}%</div>
</div>
<div class="stock-name">${stock.name}</div>
<div class="stock-price-row">
<div class="stock-price">$${stock.price.toFixed(2)}</div>
<div class="stock-change ${changeClass}">${stock.change>=0?'+':''}${(stock.price*stock.change/100).toFixed(2)}</div>
</div>
</div>
`;
}).join('');
}

function selectStock(idx){
state.currentStock=state.stocks[idx];
renderStockList();
updateChartInfo();
renderGreeks();
renderNextEarnings();
renderPastEarnings();
drawChart();
}

function updateChartInfo(){
if(!state.currentStock)return;
document.getElementById('chartSymbol').textContent=state.currentStock.symbol;
document.getElementById('chartTitle').textContent=state.currentStock.name;
document.getElementById('chartExchange').textContent=state.currentStock.isIndex?'INDEX':'NASDAQ';
document.getElementById('mainPrice').textContent=state.currentStock.price.toFixed(2);
const changeValue=(state.currentStock.price*state.currentStock.change/100).toFixed(2);
const changeElement=document.getElementById('priceChange');
const changeClass=state.currentStock.change>=0?'gain':'loss';
changeElement.textContent=`${state.currentStock.change>=0?'+':''}${changeValue} (${state.currentStock.change>=0?'+':''}${state.currentStock.change.toFixed(2)}%)`;
changeElement.className=`price-change-badge ${changeClass}`;
}

function changeTimeframe(tf){
document.querySelectorAll('.timeframe-btn').forEach(btn=>{
btn.classList.toggle('active',btn.textContent.includes(tf.replace(/[DWM]/g,match=>({D:'J',W:'S',M:'M'}[match]))));
});
drawChart();
}

function showView(viewName){
document.querySelectorAll('.content-view').forEach(v=>v.classList.remove('active'));
document.querySelectorAll('.menu-item').forEach(m=>m.classList.remove('active'));
const view=document.getElementById(`${viewName}-view`);
if(view)view.classList.add('active');
const menuIndex=['cockpit','earnings','simulator'].indexOf(viewName);
if(menuIndex>=0){
document.querySelectorAll('.menu-item')[menuIndex].classList.add('active');
}
}

function handleSearch(e){
const query=e.target.value.toUpperCase();
if(!query){
renderStockList();
return;
}
const filtered=state.stocks.filter(s=>s.symbol.includes(query)||s.name.toUpperCase().includes(query));
const list=document.getElementById('stockList');
if(filtered.length===0){
list.innerHTML='<div style="text-align:center;padding:2rem;color:var(--gray-500);font-size:0.9rem">Aucun r√©sultat</div>';
}else{
const temp=state.stocks;
state.stocks=filtered;
renderStockList();
state.stocks=temp;
}
}

document.getElementById('greekModal')?.addEventListener('click',function(e){
if(e.target===this){
closeGreekModal();
}
});

window.addEventListener('resize',()=>drawChart());
document.addEventListener('DOMContentLoaded',init);
window.ApexCockpit={state,API_CONFIG,version:'8.0.0 AI INTELLIGENCE'};
console.log('%cüß† Apex AI Intelligence v8.0.0','font-size:20px;font-weight:bold;color:#8B5CF6');
console.log('%cAlpha Vantage | Real Earnings | Smart Strategies','font-size:12px;color:#666');
</script>
</body>
</html>
